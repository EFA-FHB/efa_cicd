name: docker_push_image
description: "Pushes a container image with Docker"

inputs:
  imageid:
    description: "Id of docker image to push"
    required: true
  tag-file-name:
    description: "name of tag file"
    required: false
outputs:
  tag:
    description: "Tag of the pushed docker image"
    value: "${{ steps.push_image.outputs.tag }}"
  

runs:
  using: "composite"

  steps:
    - name: Push image
      id: push_image
      shell: bash
      env:
        tag-file-name: ${{inputs.tag-file-name && inputs.tag-file-name || 'pushed_tags.txt' }}
      run: |
        origImage=${{ inputs.imageid }}
        image_name=$(echo $origImage | cut -d":" -f1)
        tag=$(echo $origImage | cut -d":" -f2)

        docker push $origImage

        echo "::set-output name=tag::$tag"
        echo "$tag" > ${{env.tag-file-name}}
        echo "::set-output name=tag_file_name::${{env.tag-file-name}}"

    - uses: actions/upload-artifact@v2
      with:
        name: "${{ steps.push_image.outputs.tag }}"
        path: ${{ steps.push_image.outputs.tag_file_name }}