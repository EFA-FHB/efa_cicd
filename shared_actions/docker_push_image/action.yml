name: docker_push_image
description: "Pushes a container image with Docker"

inputs:
  imageid:
    description: "Id of docker image to push"
    required: true
outputs:
  tag:
    description: "Tag of the pushed docker image"
    value: "${{ steps.push_image.outputs.tag }}"
  tag-file-name:
    description: "Name of uploaded artifacts file including tags for pushed docker image"
    value: "${{ steps.push_image.outputs.tag_file_name }}"

runs:
  using: "composite"

  steps:
    - name: Push image
      id: push_image
      shell: bash
      run: |
        origImage=${{ inputs.imageid }}
        image_name=$(echo $origImage | cut -d":" -f1)
        tag=$(echo $origImage | cut -d":" -f2)
        tag_file_name="${image_name}_tags.txt"

        echo "::set-output name=tag_file_name::$tag_file_name"

        docker push $origImage

        echo "::set-output name=tag::$tag"
        echo "$tag" > $tag_file_name

    - uses: actions/upload-artifact@v2
      with:
        name: "${{ steps.push_image.outputs.tag }}"
        path: "${{ steps.push_image.outputs.tag_file_name }}"